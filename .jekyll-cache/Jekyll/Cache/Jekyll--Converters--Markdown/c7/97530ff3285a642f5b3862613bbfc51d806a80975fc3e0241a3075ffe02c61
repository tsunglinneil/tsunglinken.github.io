I"e†<p>Flyway æ˜¯ä¸€å¥—é–‹æºæ•¸æ“šåº«é·ç§»å·¥å…·ï¼Œèƒ½å¤ åšåˆ°è³‡æ–™åº«çš„ç‰ˆæœ¬ç®¡ç†ï¼Œä¸¦å³æ™‚çš„å®Œæˆè³‡æ–™é·ç§»ä½œæ¥­ã€‚</p>

<p>æœ¬æ–‡å°‡åœ¨ 20 åˆ†é˜å…§ï¼Œé€é 2 å€‹è§€å¿µå»ºç«‹ã€3 å€‹å¯¦éš›ç”¨ä¾‹ï¼Œå¸¶ä½ æ˜ç™½ Flyway æ˜¯ä»€éº¼ï¼Œä¸¦å½™æ•´ 3 æ­¥é©Ÿå¯¦è¸è³‡æ–™åº«ç‰ˆæ§ã€4 æ­¥é©Ÿç«‹å³å°å…¥æ—¢æœ‰å°ˆæ¡ˆä¸­ã€‚</p>

<h2 id="æœ¬æ–‡æ¶æ§‹"><strong>æœ¬æ–‡æ¶æ§‹</strong></h2>

<div><img src="/images/flyway/agenda.jpg" width="800" height="150" alt="" /></div>

<h2 id="é¦–å…ˆç‚ºä½•éœ€è¦è³‡æ–™åº«é·ç§»"><strong>é¦–å…ˆï¼Œç‚ºä½•éœ€è¦è³‡æ–™åº«é·ç§»?</strong></h2>

<p>åœ¨ Flyway ä¸­ï¼Œä»»ä½•å°è³‡æ–™åº«é€²è¡Œçš„ç•°å‹•éƒ½ç¨±ç‚º Migration(é·ç§»)</p>

<p>åœ¨é–‹ç™¼æ–°å°ˆæ¡ˆã€ç¶­è­·æ—¢æœ‰ç³»çµ±ã€è™•ç†å„å¼ CR çš„é–‹ç™¼é€±æœŸä¸­ï¼Œé¢å°å„ç¨®ä¸åŒç‹€æ³ï¼Œå‹¢å¿…æœƒè®Šæ›´åˆ°è³‡æ–™åº«çš„è¨­è¨ˆï¼Œä¾‹å¦‚: ç•°å‹•æ¬„ä½ã€ç´¢å¼•è®Šæ›´ç­‰ç­‰â€¦</p>

<p>è€Œä¸Šè¿°é€™äº›ç•°å‹•ä¹Ÿéƒ½å°‡ç”±ä¸åŒçš„é–‹ç™¼äººå“¡é€²è¡Œï¼Œé€šå¸¸æœƒéœ€è¦å°‡ç•°å‹•çµ±ä¸€é€²è¡Œç¶­è­·ï¼Œä»¥åˆ©é–‹ç™¼é€±æœŸå„å€‹éšæ®µåŸ·è¡Œã€‚</p>

<p>åœ¨å¯¦å‹™ä¸Šï¼Œä¸åŒé–‹ç™¼äººå“¡ã€å¤šå€‹ç’°å¢ƒï¼Œæ­¤æ™‚æ‰‹å‹•åŸ·è¡Œè³‡æ–™åº«çš„ç•°å‹•å°‡å¯èƒ½å‡ºç¾å¦‚ä¸‹ç‹€æ³</p>

<ol>
  <li>ç·šä¸Šå•é¡Œä¿®å¾©çš„è³‡æ–™åº«ç•°å‹•æ²’æœ‰åŒæ­¥åˆ°å„å€‹æ¸¬è©¦ç’°å¢ƒ</li>
  <li>æ›´æ–°ç‰ˆæœ¬å°šæœªé å…ˆåŸ·è¡Œç•°å‹•è…³æœ¬å°è‡´å‡ºéŒ¯</li>
  <li>ç•°å‹•è…³æœ¬æŒ‡ä»¤éŒ¯èª¤ä¸¦æœªè¢«åŠæ™‚ç™¼ç¾</li>
</ol>

<p>è¦æ¸›å°‘ä¸Šè¿°å•é¡Œï¼Œæˆ‘å€‘å¸Œæœ›èƒ½å¤ å¯¦ç¾ä¸‹åˆ—äº‹é …ï¼š</p>

<ol>
  <li>æœ‰æ•ˆè¿½è¹¤è³‡æ–™åº«ç•°å‹•æ­·ç¨‹ã€‚</li>
  <li>å„å€‹ç’°å¢ƒçš„è³‡æ–™åº«ç•°å‹•ä¸å¿…æ‰‹å‹•åŸ·è¡Œï¼Œé™ä½éŒ¯èª¤ç‡ã€‚</li>
  <li>æ¯æ¬¡ç¨‹å¼é€²è¡Œæ›´ç‰ˆæ™‚èƒ½å¤ ç«‹å³åŸ·è¡Œ DDL &amp; DML è®Šæ›´ã€‚</li>
</ol>

<p>ç‚ºäº†é”åˆ°ä¸Šè¿°ç›®æ¨™ï¼Œæˆ‘å€‘å°‡ä½¿ç”¨ Flyway ä¾†æ›¿æˆ‘å€‘å¯¦ç¾ã€‚</p>

<h2 id="flyway-è³‡æ–™åº«é·ç§»é‹ä½œæ–¹å¼"><strong>Flyway è³‡æ–™åº«é·ç§»é‹ä½œæ–¹å¼ï¼Ÿ</strong></h2>

<h3 id="-åŸºæœ¬é‹ä½œåŸç†">â– åŸºæœ¬é‹ä½œåŸç†</h3>

<p><strong>â¶ é€éæ­·å²ç´€éŒ„è¡¨ (flyway_schema_history) ç´€éŒ„æ¯ä¸€æ¬¡çš„è³‡æ–™åº«ç•°å‹•</strong></p>

<p>Flyway é¦–å…ˆæœƒæª¢æŸ¥è³‡æ–™åº«ä½¿å¦æœ‰æ­¤ç´€éŒ„è¡¨ (flyway_schema_history) ï¼Œè‹¥æ²’æœ‰å‰‡æœƒå„ªå…ˆå»ºç«‹æ­¤è¡¨ï¼Œæ¥è‘—é‡å°éœ€è¦è¢«åŸ·è¡Œçš„ SQL æª”æ¡ˆï¼Œæœƒå…ˆè¨ˆç®—å‡º checksum ä½œç‚ºé©—è­‰ï¼Œæ–¼æ¯æ¬¡ Flyway å•Ÿå‹•æ™‚æ ¹æ“š checksum é©—è­‰è³‡æ–™åº«æ˜¯å¦éœ€è¦è¢«æ›´æ”¹ã€‚</p>

<p>å‚™è¨»ï¼šchecksum è¨ˆç®—æ¡ç”¨ crc-32 checksumã€‚</p>

<p><strong>â· é€é SQL æˆ– Java ç·¨å¯« DDL/DMLï¼Œä¸¦å®šç¾©å…¶ç‰ˆè™Ÿä½¿ Flyway é€²è¡Œæƒæä¸¦åŸ·è¡Œ</strong></p>

<p>Flyway å°‡å¯è¨­å®šåŸ·è¡Œé †åºï¼Œé è¨­ä¾æ“šç‰ˆè™Ÿé€²è¡Œæ’åºåŸ·è¡Œï¼Œä¸¦ä¸”å¯«å…¥æ­·å²ç´€éŒ„è¡¨ (flyway_schema_history) ï¼ŒFlyway æä¾›å¤šç¨® Migration çš„æ–¹å¼ï¼Œä»¥ä¸‹å°‡é‡å° Migration çš„é¡å‹ã€å¯¦ä½œåšæ›´è©³ç´°çš„ä»‹ç´¹ã€‚</p>

<h3 id="-é·ç§»çš„é¡å‹">â– é·ç§»çš„é¡å‹</h3>

<p><strong>â¶ Versioned Migrationsï¼ˆç‰ˆæœ¬é·ç§»ï¼‰</strong></p>

<p>ç”¨æ–¼å‰µå»ºã€æ›´æ–°ã€åˆªé™¤ï¼šè¡¨ã€ç´¢å¼•ã€å¤–éµã€‚</p>

<p><strong>â· Undo Migrationsï¼ˆæ’¤éŠ·é·ç§»ï¼‰</strong></p>

<p>å³ç‚º Versioned Migratios çš„å›æ»¾æ©Ÿåˆ¶ã€‚</p>

<p><strong>â¸ Repeatable Migrationsï¼ˆé‡è¤‡é·ç§»ï¼‰</strong></p>

<p>ç”¨æ–¼å»ºç«‹ views/procedures/functions/packages/â€¦ä»¥åŠæ‰¹æ¬¡å¯«å…¥ç‰¹å®šæ•¸æ“šã€‚</p>

<h3 id="-é·ç§»çš„å¯¦ä½œ">â– é·ç§»çš„å¯¦ä½œ</h3>

<p><strong>â¶ SQL-based migrations</strong></p>

<p>é€™æ˜¯æœ€å¸¸ä½¿ç”¨ä¹Ÿæœ€ä¾¿åˆ©çš„å¯¦ä½œæ–¹å¼ï¼Œä¸»è¦ç”¨æ–¼å¯¦ä½œ DDL çš„è®Šæ›´åŠç°¡å–®çš„è³‡æ–™ç•°å‹•ã€‚</p>

<p>å‘½åè¦å‰‡: (æ“·å–å®˜æ–¹åœ–ç‰‡)</p>

<div><img src="/images/flyway/sql-migration1.png" width="800" height="150" alt="" /></div>

<p><strong>â· Java-based migrations</strong></p>

<p>å¯¦ä½œæƒ…å¢ƒç”¨æ–¼ BLOB &amp; CLOB çš„è®Šæ›´ä»¥åŠè¼ƒç‚ºè¤‡é›œçš„è³‡æ–™ç•°å‹•ã€‚</p>

<p>é¡åˆ¥å‘½åè¦å‰‡: (æ“·å–å®˜æ–¹åœ–ç‰‡)</p>

<div><img src="/images/flyway/java-migration1.png" width="800" height="150" alt="" /></div>

<p><strong>â¸ Script migrations</strong></p>

<p>ç›®å‰å®˜æ–¹æ”¯æ´ .ps1, .bat, .cmd, .sh, .bash, .py çš„è…³æœ¬æ’°å¯«ï¼Œå…¶å‘½åæ–¹å¼èˆ‡ SQL-based migrations ç›¸åŒï¼Œåªå·®åœ¨è…³æœ¬çš„å‰¯æª”åä¸åŒã€‚</p>

<h2 id="å¦‚ä½•é–‹å§‹ä½¿ç”¨-flyway-"><strong>å¦‚ä½•é–‹å§‹ä½¿ç”¨ Flyway ï¼Ÿ</strong></h2>

<p>ç­è§£åŸºæœ¬ Flyway çš„ Migration é¡å‹èˆ‡å¯¦ä½œç¨®é¡ï¼Œæ¥è‘—æˆ‘å°‡ä»¥ Spring Boot èˆ‡æ¸¬è©¦æ¡†æ¶ TestContainers é€²è¡Œå¯¦å‹™ä¸Šé–‹ç™¼èˆ‡æ¸¬è©¦çš„èªªæ˜ã€‚</p>

<h3 id="-å¯¦ä½œä¸€-æ­é…-spring-boot">â– å¯¦ä½œä¸€. æ­é… Spring Boot</h3>

<p>ä»¥ä¸‹ä¸‰æ­¥é©Ÿå³å®Œæˆ Flyway åŸºæ–¼ Spring Boot çš„å¯¦éš›ç”¨ä¾‹é…ç½®</p>

<p><strong>â¶Â Maven é…ç½®</strong></p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;java.version&gt;</span>11<span class="nt">&lt;/java.version&gt;</span>
    <span class="nt">&lt;testcontainers.version&gt;</span>1.15.2<span class="nt">&lt;/testcontainers.version&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;dependencies&gt;</span>
    <span class="c">&lt;!--Spring--&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span><span class="sb">

    &lt;!--Logger--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!--Database--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;mysql&lt;/groupId&gt;
        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;version&gt;8.0.23&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!--Flyway--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.flywaydb&lt;/groupId&gt;
        &lt;artifactId&gt;flyway-core&lt;/artifactId&gt;
        &lt;version&gt;6.5.7&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!--Testing--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
        &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
        &lt;artifactId&gt;mysql&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;

</span><span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;dependencyManagement&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.testcontainers<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>testcontainers-bom<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${testcontainers.version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/dependencyManagement&gt;</span>
</code></pre></div></div>

<p><strong>â·Â  è¨­å®šæª”é…ç½®</strong></p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># ==============================================================</span>

<span class="gh"># = è³‡æ–™åº«è¨­å®š(é Testcontainers è³‡æ–™åº«è¨­å®š)</span>

<span class="gh"># ==============================================================</span>

spring.datasource.url=jdbc:mysql://localhost:3307/flyway_db?useUnicode=true&amp;characterEncoding=utf-8&amp;socketTimeout=60000&amp;connectTimeout=30000
spring.datasource.username=flyuser
spring.datasource.password=123456
spring.jpa.show-sql=true
spring.jpa.open-in-view=true
spring.jpa.properties.hibernate.connection.release_mode=AUTO
spring.jpa.hibernate.ddl-auto=validate

<span class="gh">#æœ€å°ç©ºé–’é€£æ¥æ•¸</span>
spring.datasource.hikari.minimum-idle=10 #é€£æ¥æ± æœ€å¤§å¤§å°
spring.datasource.hikari.maximum-pool-size=50 #é€£æ¥æœ€å¤§ç©ºé–’æ™‚é•·
spring.datasource.hikari.idle-timeout=60000 #é€£æ¥ç”Ÿå‘½æ™‚é•·
spring.datasource.hikari.max-lifetime=1800000 #é€£æ¥çš„è¶…æ™‚æ™‚é•·
spring.datasource.hikari.connection-timeout=30000

<span class="gu">## ==============================================================</span>

<span class="gu">## FLYWAY é…ç½®</span>

<span class="gu">### ==============================================================</span>

spring.flyway.url=jdbc:mysql://localhost:3307/flyway_db?useUnicode=true&amp;characterEncoding=utf-8&amp;socketTimeout=60000&amp;connectTimeout=30000
spring.flyway.user=flyuser
spring.flyway.password=123456
spring.flyway.locations=classpath:doc/migration/common,classpath:db/migration
spring.flyway.table=flyway_schema_history
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=1.0
spring.flyway.out-of-order=true
spring.flyway.validate-on-migrate=true
spring.flyway.enabled=true

<span class="gh"># ==============================================================</span>

<span class="gh"># = LOGGING</span>

<span class="gh"># ==============================================================</span>

logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.org.flywaydb=debug
logging.level.root=debug
</code></pre></div></div>

<p><strong>â¸Â  å»ºç½® Migration æª”æ¡ˆ(æ­¤ä¾‹ä½¿ç”¨ SQL ï¼† Javaï¼‰</strong></p>

<p><strong>SQL Base Migration</strong></p>

<p>â— V1.0__sql_base_migration_ddl.sql</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">book_case</span>
<span class="p">(</span>
  <span class="n">id</span> <span class="nb">char</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">comment</span> <span class="s1">'æµæ°´è™Ÿ'</span><span class="p">,</span>
  <span class="n">title</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">comment</span> <span class="s1">'æ›¸å'</span><span class="p">,</span>
  <span class="n">author</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">comment</span> <span class="s1">'ä½œè€…'</span><span class="p">,</span>
  <span class="n">translator</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">comment</span> <span class="s1">'è­¯è€…'</span><span class="p">,</span>
  <span class="n">publisher</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">comment</span> <span class="s1">'å‡ºç‰ˆç¤¾'</span><span class="p">,</span>
  <span class="n">publication_date</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">comment</span> <span class="s1">'å‡ºç‰ˆæ—¥æœŸ'</span><span class="p">,</span>
  <span class="n">create_time</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">comment</span> <span class="s1">'å‰µå»ºæ™‚é–“'</span><span class="p">,</span>
  <span class="n">update_time</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">comment</span> <span class="s1">'æ›´æ–°æ™‚é–“'</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
  <span class="k">KEY</span> <span class="n">index_createTime</span> <span class="p">(</span><span class="n">create_time</span><span class="p">)</span>
<span class="p">)</span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8mb4_0900_ai_ci</span><span class="p">;</span>
</code></pre></div></div>

<p>â— V1.1__sql_base_migration_dml.sql</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">book_case</span> <span class="p">(</span>
    <span class="n">id</span><span class="p">,</span>
    <span class="n">title</span><span class="p">,</span>
    <span class="n">author</span><span class="p">,</span>
    <span class="n">translator</span><span class="p">,</span>
    <span class="n">publisher</span><span class="p">,</span>
    <span class="n">publication_date</span><span class="p">,</span>
    <span class="n">create_time</span><span class="p">,</span>
    <span class="n">update_time</span><span class="p">)</span>
  <span class="k">VALUES</span> <span class="p">(</span>
    <span class="s1">'0157e79c-b2dd-4efe-ad40-320cc94c051e'</span><span class="p">,</span>
    <span class="s1">'THE INFINITE GAME'</span><span class="p">,</span>
    <span class="s1">'Simon Sinek'</span><span class="p">,</span>
    <span class="s1">'Huang Tingmin'</span><span class="p">,</span>
    <span class="s1">'Commonwealth Magazine'</span><span class="p">,</span>
    <span class="s1">'2020-12-30 00:00:00'</span><span class="p">,</span>
    <span class="s1">'2021-04-13 20:55:36'</span><span class="p">,</span>
    <span class="s1">'2021-04-13 20:55:36'</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>Java Base Migration</strong></p>

<p>â— R__java_base_migration_sample.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">db.migration</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.flywaydb.core.api.migration.BaseJavaMigration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.flywaydb.core.api.migration.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.JdbcTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.PreparedStatementSetter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.sql.PreparedStatement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.SQLException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Timestamp</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">R__uuid_generator</span> <span class="kd">extends</span> <span class="nc">BaseJavaMigration</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">migrate</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="no">UUID</span> <span class="n">id</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">();</span>
        <span class="nc">LocalDateTime</span> <span class="n">publishDate</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2020</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"INSERT INTO book_case (id, title, author, translator, publisher, publication_date, create_time, update_time) VALUES (?, ?, ?, ?, ?, ?, ?, ?)"</span><span class="o">;</span>

        <span class="nc">JdbcTemplate</span> <span class="n">template</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JdbcTemplate</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">getDataSource</span><span class="o">());</span>
        <span class="n">template</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">sql</span><span class="o">,</span> <span class="k">new</span> <span class="nc">PreparedStatementSetter</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setValues</span><span class="o">(</span><span class="nc">PreparedStatement</span> <span class="n">preparedStatement</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
                <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">id</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
                <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">"THE INFINITE GAME"</span><span class="o">);</span>
                <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="s">"Simon Sinek"</span><span class="o">);</span>
                <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="s">"Huang Tingmin"</span><span class="o">);</span>
                <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="s">"Commonwealth Magazine"</span><span class="o">);</span>
                <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setTimestamp</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="nc">Timestamp</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">publishDate</span><span class="o">));</span>
                <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setTimestamp</span><span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="nc">Timestamp</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">()));</span>
                <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setTimestamp</span><span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="nc">Timestamp</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">()));</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p><strong>å°ˆæ¡ˆæ¶æ§‹ä»¥åŠé…ç½®åƒæ•¸èªªæ˜</strong></p>

<p>â— å°ˆæ¡ˆçµæ§‹ (åˆ†åˆ¥åˆ—å‡º SQL Base Migration &amp; Java Base Migration)</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”œâ”€â”€ pom.xml
â”œâ”€â”€ src
â”‚ â”œâ”€â”€ main
â”‚ â”‚ â”œâ”€â”€ java
â”‚ â”‚ â”‚ â”œâ”€â”€ META-INF
â”‚ â”‚ â”‚ â”œâ”€â”€ com
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ tpisoftware
â”‚ â”‚ â”‚ â””â”€â”€ db
â”‚ â”‚ â”‚ â””â”€â”€ migration
â”‚ â”‚ â”‚ â””â”€â”€ Rï¼¿java_base_migration_sample.java
â”‚ â”‚ â””â”€â”€ resources
â”‚ â”‚ â”œâ”€â”€ doc
â”‚ â”‚ â”‚ â”œâ”€â”€ migration
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ common
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ V1.0ï¼¿sql_base_migration_ddl.sql
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ V1.1ï¼¿sql_base_migration_dml.sql
</code></pre></div></div>

<p>â— é…ç½®åƒæ•¸æ¦‚è¿°</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â—† é€£ç·šé…ç½®
èˆ‡ datasource é…ç½®ç›¸åŒï¼Œç•¶ Application å•Ÿå‹•æ™‚ï¼Œflyway å°‡æœƒé€²è¡Œé€£ç·šï¼Œä¸¦åŸ·è¡Œ migration
â€£ spring.flyway.url
â€£ spring.flyway.user
â€£ spring.flyway.password

â—† æª”æ¡ˆå­˜å–ä½ç½®
å¯æ¥å—å¤šå€‹åƒæ•¸(è«‹ç”¨é€—è™Ÿåˆ†éš”)ï¼ŒæŒ‡å®š flyway è®€å–åŸ·è¡Œ migration çš„è·¯å¾‘
â€£ spring.flyway.locations

â—† æ­·å²ç´€éŒ„è¡¨å®šç¾©
Flyway æ­·å²ç´€éŒ„è¡¨é è¨­å‘½åç‚º flyway_schema_historyï¼Œè‹¥æœ‰éœ€è¦å¯ä»¥æ›´æ”¹åç¨±
â€£ spring.flyway.table

â—† æ˜¯å¦åŸ·è¡Œèµ·å§‹ç‰ˆè™Ÿ
ç•¶è³‡æ–™åº«ä¸ç‚ºç©ºï¼Œæ˜¯å¦è¦åŸ·è¡Œèµ·å§‹ç‰ˆæœ¬ï¼Œä¸¦å»ºç«‹æ­·å²ç´€éŒ„è¡¨ï¼Œé è¨­ç‚º falseï¼Œå¦‚æœä¸¦éåœ¨å°ˆæ¡ˆä¸€é–‹å§‹å°±å°å…¥ flywayï¼Œå°±éœ€è¦è¨­å®šç‚º true
â€£ spring.flyway.baseline-on-migrate

â—† èµ·å§‹ç‰ˆæœ¬è¨­å®š
è¨­å®š migration çš„èµ·å§‹ç‰ˆè™Ÿ
â€£ spring.flyway.baseline-version

â—† åŸ·è¡Œ migration æ˜¯å¦å…è¨±ç„¡åºåŸ·è¡Œ
â€£ spring.flyway.out-of-order

â—† åŸ·è¡Œ migration æ˜¯å¦è‡ªå‹•é©—è­‰
â€£ spring.flyway.validate-on-migrate

â—† æ˜¯å¦å•Ÿç”¨ Flyway
â€£ spring.flyway.enabled
</code></pre></div></div>

<h3 id="-å¯¦ä½œäºŒ-æ­é…æ¸¬è©¦æ¡†æ¶-testcontainers-çš„é©—è­‰">â– å¯¦ä½œäºŒ. æ­é…æ¸¬è©¦æ¡†æ¶ TestContainers çš„é©—è­‰</h3>

<p>ä»¥ä¸‹èªªæ˜ Flyway åŸºæ–¼ Spring Boot Test With TestContainers çš„æ¸¬è©¦é©—è­‰ã€‚</p>

<p><strong>â¶ å®¹å™¨åŒ–æ¸¬è©¦åŸºæœ¬å»ºç«‹æ–¹å¼å¯ä»¥<a href="https://www.tpisoftware.com/tpu/articleDetails/1997">é»é¸æ­¤æŸ¥é–±æ­¤ç¯‡æ–‡ç« </a>ï¼Œæœ‰è©³ç´°ä»‹ç´¹å®¹å™¨åŒ–æ¸¬è©¦æ¡†æ¶ï¼Œæ­¤æ–‡ä¸è´…è¿°ã€‚</strong></p>

<p><strong>â· å‹•æ…‹è¼‰å…¥ datasource åƒæ•¸ï¼ŒæŒ‡å®šçµ¦ flyway çš„é€£ç·šé…ç½®(èˆ‡ spring datasource ç›¸åŒ)</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * å‹•æ…‹è¨­å®šåƒæ•¸
 * @param registry
 */</span>
<span class="nd">@DynamicPropertySource</span>
<span class="kd">static</span> <span class="kt">void</span> <span class="nf">mssqlProperties</span><span class="o">(</span><span class="nc">DynamicPropertyRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//mysql properties setting</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.driver-class-name"</span><span class="o">,</span> <span class="nl">mySQLContainer:</span><span class="o">:</span><span class="n">getDriverClassName</span><span class="o">);</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.url"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">mySQLContainer</span><span class="o">.</span><span class="na">getJdbcUrl</span><span class="o">());</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.username"</span><span class="o">,</span> <span class="nl">mySQLContainer:</span><span class="o">:</span><span class="n">getUsername</span><span class="o">);</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.password"</span><span class="o">,</span> <span class="nl">mySQLContainer:</span><span class="o">:</span><span class="n">getPassword</span><span class="o">);</span>

    <span class="c1">//flyway properties setting</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.flyway.url"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">mySQLContainer</span><span class="o">.</span><span class="na">getJdbcUrl</span><span class="o">());</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.flyway.user"</span><span class="o">,</span> <span class="nl">mySQLContainer:</span><span class="o">:</span><span class="n">getUsername</span><span class="o">);</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.flyway.password"</span><span class="o">,</span> <span class="nl">mySQLContainer:</span><span class="o">:</span><span class="n">getPassword</span><span class="o">);</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.flyway.enabled"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"true"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>â¸ å®Œæˆé…ç½®é‹è¡Œ Spring Test æ™‚æœƒé€²è¡Œä»¥ä¸‹å‹•ä½œï¼š</strong></p>

<p>â— TestContainers å•Ÿå‹•æœ¬åœ°ç«¯çš„ MySQL Container</p>

<div><img src="/images/flyway/testcontainers1.png" width="800" height="150" alt="" /></div>

<p>â— Flyway é€²è¡Œé©—è­‰</p>

<div><img src="/images/flyway/testcontainers2.png" width="800" height="150" alt="" /></div>

<p>â— Flyway åŸ·è¡Œ Migration</p>

<div><img src="/images/flyway/testcontainers3.png" width="800" height="150" alt="" /></div>

<p>â— é‹è¡Œæ¸¬è©¦ç¨‹å¼</p>

<div><img src="/images/flyway/testcontainers4.png" width="800" height="150" alt="" /></div>

<h3 id="-å¯¦ä½œä¸‰-ä½¿ç”¨-maven-é‹è¡Œ-flyway">â– å¯¦ä½œä¸‰. ä½¿ç”¨ Maven é‹è¡Œ Flyway</h3>

<p>ä»¥ä¸‹ç‚º Flyway åŸºæ–¼ Maven çš„å¯¦éš›ç”¨ä¾‹ã€‚</p>

<p><strong>â¶ æ–°å¢ Maven-Plugin</strong></p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.flywaydb<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>flyway-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>6.5.7<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div></div>

<p><strong>â· Maven Flyway Configuration é…ç½®</strong></p>

<p><a href="https://flywaydb.org/documentation/database/mysql">è«‹é»é¸é€™è£¡æŸ¥çœ‹è³‡æ–™åº«æ”¯æ´åŠè¨­å®šèªªæ˜</a>ï¼ˆæœ¬ä¾‹ä½¿ç”¨ MySQLï¼Œä¸¦åœ¨æœ¬åœ°ç«¯å•Ÿç”¨ Docker mysql/mysql-server:8.0 ä½œæ¸¬è©¦ï¼‰</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;driver&gt;</span>com.mysql.jdbc.Driver<span class="nt">&lt;/driver&gt;</span>
    <span class="nt">&lt;url&gt;</span>jdbc:mysql://localhost:3307/flyway_db<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;user&gt;</span>flyuser<span class="nt">&lt;/user&gt;</span>
    <span class="nt">&lt;password&gt;</span>123456<span class="nt">&lt;/password&gt;</span>
    <span class="nt">&lt;connectRetries&gt;</span>3<span class="nt">&lt;/connectRetries&gt;</span>
    <span class="nt">&lt;createSchemas&gt;</span>true<span class="nt">&lt;/createSchemas&gt;</span>
    <span class="nt">&lt;table&gt;</span>flyway_schema_history<span class="nt">&lt;/table&gt;</span>
    <span class="nt">&lt;locations&gt;</span>
        <span class="nt">&lt;location&gt;</span>classpath:doc/migration/common<span class="nt">&lt;/location&gt;</span>
        <span class="nt">&lt;location&gt;</span>classpath:db/migration<span class="nt">&lt;/location&gt;</span>
    <span class="nt">&lt;/locations&gt;</span>
    <span class="nt">&lt;encoding&gt;</span>utf-8<span class="nt">&lt;/encoding&gt;</span>
    <span class="nt">&lt;target&gt;</span>1.0<span class="nt">&lt;/target&gt;</span>
    <span class="nt">&lt;outOfOrder&gt;</span>true<span class="nt">&lt;/outOfOrder&gt;</span>
    <span class="nt">&lt;validateOnMigrate&gt;</span>true<span class="nt">&lt;/validateOnMigrate&gt;</span>
    <span class="nt">&lt;baselineOnMigrate&gt;</span>true<span class="nt">&lt;/baselineOnMigrate&gt;</span>
    <span class="nt">&lt;baselineVersion&gt;</span>1.0<span class="nt">&lt;/baselineVersion&gt;</span>
    <span class="nt">&lt;baselineDescription&gt;</span>Let's go!<span class="nt">&lt;/baselineDescription&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div></div>

<p><strong>â¸ åŸ·è¡Œ Migration(-X æŸ¥çœ‹å®Œæ•´ç´€éŒ„)</strong></p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn flyway:migrate -X
</code></pre></div></div>

<p><strong>â¹ é‹è¡Œçµæœï¼ˆé™„ä¸Šåˆ†æ®µæˆªåœ–ï¼‰</strong></p>

<p><strong>Maven åŸ·è¡Œï¼ŒFlyway è®€å– Migration æª”æ¡ˆä¸­</strong></p>

<div><img src="/images/flyway/mvn1.png" width="800" height="150" alt="" /></div>
<div><img src="/images/flyway/mvn2.png" width="800" height="150" alt="" /></div>
<p><strong>Flyway çš„ Migration æª”æ¡ˆé©—è­‰é€šéå¾Œï¼Œæœƒé–‹å§‹åŸ·è¡Œ Migration</strong></p>
<div><img src="/images/flyway/mvn3.png" width="800" height="150" alt="" /></div>

<p><strong>æŸ¥çœ‹è³‡æ–™åº«ï¼Œç¢ºèª DDL &amp; DML ç¢ºå¯¦åŸ·è¡Œå®Œç•¢</strong></p>

<div><img src="/images/flyway/mvn4.png" width="800" height="150" alt="" /></div>

<p><strong>ç­è§£ä¸Šè¿°çš„é‹ä½œåŸç†åŠå¯¦ä½œæ–¹å¼ï¼Œå¦å¤–å¯ä¾æ“šå°ˆæ¡ˆéœ€æ±‚è‡ªè¡Œæ±ºå®šä»¥ä¸‹åŸ·è¡Œ Migration çš„æ–¹å¼</strong></p>

<p><strong>â¶ Command-line tool</strong></p>

<p>Linux / Docker / Windows /Mac OS çš†æœ‰æ”¯æ´ã€‚</p>

<p><a href="https://flywaydb.org/documentation/usage/commandline/">é»é¸æ­¤ç›´æ¥æŸ¥çœ‹å®˜ç¶²ä½¿ç”¨èªªæ˜ã€‚</a></p>

<p><strong>â· Gradle</strong></p>

<p>æ”¯æ´ Gradle 3.x, Gradle 4.x, Gradle 5.x, and Gradle 6.x å¯é‹è¡Œåœ¨ Java 8, Java 9, Java 10, Java 11 or Java 12.</p>

<p><a href="https://flywaydb.org/documentation/usage/gradle/">é»é¸æ­¤ç›´æ¥æŸ¥çœ‹å®˜ç¶²ä½¿ç”¨èªªæ˜ã€‚</a></p>

<h2 id="æ—¢æœ‰ç³»çµ±å¦‚ä½•å°å…¥-flyway-"><strong>æ—¢æœ‰ç³»çµ±å¦‚ä½•å°å…¥ Flyway ï¼Ÿ</strong></h2>

<p>å‰é¢çš„æƒ…å¢ƒéƒ½æ˜¯ä»¥è³‡æ–™åº«åˆå§‹åŒ–çš„ç‹€æ…‹èªªæ˜ï¼Œé‚£å¦‚æœæ—¢æœ‰ç³»çµ±ä¹Ÿæƒ³å°å…¥å‘¢? ä»¥ä¸‹åˆ—å‡ºå››å€‹æ­¥é©Ÿ</p>

<p><strong>â¶ å‚™ä»½ DML ä»¥åŠ åŒ¯å‡º DDLã€‚</strong></p>

<p><strong>â· å…ˆåœ¨æœ¬åœ°ç«¯å¯¦éš›é‹è¡Œä¸€æ¬¡ Migrationï¼ŒåŸ·è¡Œ DML&amp;DDLã€‚</strong></p>

<p><strong>â¸ åŒ¯å‡ºä¸Šä¸€æ­¥é©Ÿå¯«å…¥ flyway_schema_history çš„è³‡æ–™ã€‚</strong></p>

<p><strong>â¹ é€£ç·šè‡³æ¸¬è©¦ç’°å¢ƒæ‰‹å‹•å»ºç«‹ flyway_schema_history ä¸¦åŒ¯å…¥è³‡æ–™ã€‚</strong></p>

<p>åŸ·è¡Œå®Œä¸Šè¿°æ­¥é©Ÿï¼ŒFlyway å•Ÿç”¨å¾Œå³ä¸æœƒå†é‡è¤‡åŸ·è¡Œ DML &amp; DDLï¼Œåªæœƒé‹è¡Œå¾ŒçºŒæ–°å¢çš„ç‰ˆæœ¬ã€‚</p>

<h2 id="ç¸½çµ"><strong>ç¸½çµ</strong></h2>

<p>æœ¬ç¯‡æ–‡ç« æ•´ç†å‡º Flyway çš„å¯¦éš›æ¡ˆä¾‹ï¼Œç›¡å¯èƒ½é»å‡ºå¤§éƒ¨åˆ†çš„ä½¿ç”¨æƒ…å¢ƒï¼Œå¾ Migration è§€å¿µå»ºç«‹ã€æ­é…å°ˆæ¡ˆå¸¸ä½¿ç”¨çš„ Spring Bootã€æ¸¬è©¦æ¡†æ¶é©—è­‰ã€Flyway Maven Plugin ä½¿ç”¨ï¼Œä»¥åŠæ—¢æœ‰ç³»çµ±çš„å°å…¥æŒ‡å¼•ã€‚</p>

<p>Flyway æœ¬èº«æœ‰æä¾›ä»˜è²»ç‰ˆæœ¬ï¼Œåœ¨å®˜æ–¹æ–‡ä»¶ä¸­çš†ä»¥[Flyway Teams]æ¨™è¨˜æ¨™è¨»ï¼Œå¦å¤– Flyway é‚„æä¾›äº† Callback åŠŸèƒ½ï¼Œæ–¹ä¾¿æˆ‘å€‘å¯ä»¥è‡ªè¡Œä¾æ“šéœ€æ±‚åœ¨ Migration å‰åŸ·è¡Œä¸€äº›å‹•ä½œï¼Œæœ¬ç¯‡æ–‡ç« ä»‹ç´¹çš„ Migration åŠŸèƒ½åŸºæœ¬ä¸Šå°±èƒ½æ‡‰ä»˜å¤§å¤šæ•¸æƒ…å¢ƒï¼Œè€Œ Maven çš„æ–¹å¼å‰‡å¯ä»¥æ­é… CICDï¼Œç›¸ä¿¡èƒ½å¤ ä¸€å®šç¨‹åº¦ç¯€çœå°ˆæ¡ˆé–‹ç™¼å”ä½œèˆ‡äº¤ä»˜çš„æ™‚é–“ã€‚</p>

<p>æ›´å¤šçš„ç´°ç¯€ï¼Œä»¥ä¸‹æä¾›å®˜æ–¹æä¾›çš„æ–‡æª”ä»¥åŠç›¸é—œè³‡è¨Šä½œç‚ºåƒè€ƒã€‚</p>

<hr />

<div><a href="https://www.tpisoftware.com/tpu/articleDetails/2422" target="_blank">æœ¬äººç‚ºåŸæ–‡ä½œè€…ï¼ŒåŒæ­¥ç™¼å¸ƒæ–¼æ­¤</a></div>

<hr />

<p>References:</p>

<ul>
  <li>Flyway æ–‡ä»¶ <a href="https://flywaydb.org/documentation/">https://flywaydb.org/documentation/</a></li>
  <li>Flyway Spring Boot: <a href="https://flywaydb.org/documentation/usage/plugins/springboot">https://flywaydb.org/documentation/usage/plugins/springboot</a></li>
</ul>
:ET